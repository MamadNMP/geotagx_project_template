<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<div class="row alerts hide"><!-- Success and error messages. -->
    <div id="alerts-column" class="col-md-6 col-md-offset-2">
        <div id="success"       class="alert alert-success"><strong>Well done!</strong> Your answer has been saved.<a class="close">×</a></div>
        <div id="loading"       class="alert alert-info"><span>Loading next task...</span><a class="close">×</a></div>
        <div id="taskcompleted" class="alert alert-info"><strong>The task has been completed!</strong> Thanks a lot!</div>
        <div id="finish"        class="alert alert-success"><strong>Congratulations!</strong> You have participated in all available tasks!<br>
            <div class="alert-actions">
                <a class="btn small" href="/">Go back</a>
                <a class="btn small" href="/app">or, Check other projects</a>
            </div>
        </div>
        <div id="error" class="alert alert-danger"><strong>Error!</strong> Something went wrong, please contact the site administrators<a class="close">×</a></div>
    </div>
</div>

<div class="row skeleton"><!-- Skeleton row. -->
    <section id="questionnaire-section" class="col-xs-5">
    	<div id="questionnaire-summary" class="well minimized">
    <header><strong>Your analysis is <span id="questionnaire-percentage-complete">0</span>% complete</strong><button id="questionnaire-summary-details" class="pull-right btn btn-link hide" data-toggle="collapse" data-target="#questionnaire-answer-card" aria-expanded="false"><span class="hide-on-expanded"><i class="fa fa-fw fa-lg fa-info-circle"></i></span><span class="show-on-expanded"><i class="fa fa-fw fa-lg fa-times"></i></span></button></header>
    <div><ul id="questionnaire-answer-card" class="list-unstyled collapse"></ul></div>
    <div><button id="questionnaire-submit" class="btn btn-answer btn-block btn-success">Submit<span class="hidden-xs hidden-sm"> it and load another one</span></button></div>
    <div id="questionnaire-conclusion">
        <hr>
        Thank you very much for your analysis! We appreciate any feedback you may have for us so get on <a target="_blank" href="https://github.com/geotagx/pybossa/issues"><strong>GitHub</strong></a> or <a href="mailto:eleanor.rusack@unitar.org?Subject=GeoTag-X feedback" target="_top"><strong>send us an email</strong></a>.
    </div>
    <div id="questionnaire-progress-bar"></div>
</div>

<button id="questionnaire-rewind" class="btn btn-sm btn-default btn-block btn-primary show-on-task-loaded" disabled><i class="fa fa-fw fa-lg fa-arrow-circle-left"></i>&nbsp;Go to previous question</button>


        <div id="questionnaire-filter" class="question hide">
    <header>Is this photo spam?</header>
    <p>Sometimes, people collecting photos might accidentally send something that is not useful like an advertisement. If this photo is an advertisement or similar, you should choose <button class="btn btn-danger btn-xs" disabled>Yes</button> and it will be skipped.</p>
    <p>If you are not sure whether the photo is spam, selecting <button class="btn btn-xs btn-warning" disabled>I don't know</button> will also skip the image.</p>
    <p>If you do not see an image, notify us by selecting <button class="btn btn-xs btn-default" disabled>No Photo</button> and we'll fix it as soon as possible.</p>
    <p>Selecting <button class="btn btn-success btn-xs" disabled>No</button> will allow you to proceed with the analysis.</p>
    <div class="answer">
        <button class="btn btn-answer btn-success btn-sm" value="No">No</button>
        <button class="btn btn-answer btn-danger  btn-sm" value="Yes">Yes</button>
        <button class="btn btn-answer btn-warning btn-sm" value="Unknown">I don't know</button>
        <button class="btn btn-answer btn-default btn-sm" value="NoPhoto">No photo</button>
    </div>
</div>

        
        <div class="show-on-task-loaded">
    <hr>
    <div><button id="questionnaire-show-comments" class="btn btn-block btn-default btn-sm" disabled>Show comments</button></div>
    <div><button id="questionnaire-hide-comments" class="btn btn-block btn-default btn-sm hide"    >Hide comments</button></div>
    <div id="disqus_thread" class="hide"></div>
</div>

    </section>
    <section id="image-section" class="col-xs-7">
    <div class="row">
        <p   id="image-loading"><i class="fa fa-spinner fa-pulse hide-on-task-loaded"></i></p>
        <img id="image" class="img-responsive show-on-task-loaded">
        <div id="image-source-container" class="show-on-task-loaded"><strong>The original photo and its context can be found <a id="image-source" rel="nofollow" target="_blank">here<i class="fa fa-external-link"></i></a><strong></div>
        <div id="image-zoomtip" class="show-on-task-loaded">Hover your mouse over the image and use the scroll wheel to zoom in and out.<hr></div>
        <div id="image-analysis-reminder" class="show-on-task-loaded">By contributing to the Yamuna Flood Waters project, you're helping ... [Remind the user why their contribution is important]</div>
    </div>
</section>
</div>

<style type="text/css">
img.wheelzoom{cursor:crosshair}@import url("http://fonts.googleapis.com/css?family=Lato|Montserrat|Open+Sans|Patua+One|Martel+Sans|Noto+Sans");#content-main{font:400 1em Martel Sans,Open Sans,Lato}.show-on-task-loaded{display:none!important}.question{margin:0 0 1.5em 0}.question>header{font:400 1.85em Patua One;margin:0.1em 0}.btn{font-family:Montserrat;text-transform:uppercase;border-radius:2px}.answer{margin-top:1em}.help-toggle{margin:0;padding:0;cursor:help}#content{}#content-header{padding:1em 0}#questionnaire-topic{font:900 2.6em Montserrat,Open Sans!important;text-transform:uppercase}#questionnaire-section{}#questionnaire-summary{position:relative;background:#333;color:#FFF;border-radius:0.3em;overflow:hidden;margin:0 0 0.5em 0}#questionnaire-summary>header{font:400 1em Montserrat;text-transform:uppercase}#questionnaire-summary.minimized #questionnaire-submit,#questionnaire-summary.minimized #questionnaire-conclusion{display:none}#questionnaire-summary-details{color:#AAA;margin:0;padding:0;border:none;font:900 1em Montserrat;text-transform:uppercase;text-decoration:none;transition:color 0.1s ease-in-out;-o-transition:color 0.1s ease-in-out;-ms-transition:color 0.1s ease-in-out;-moz-transition:color 0.1s ease-in-out;-webkit-transition:color 0.1s ease-in-out}#questionnaire-summary-details:hover{color:#FFF}#questionnaire-summary-details:focus{outline:0 none}#questionnaire-summary-details[aria-expanded="true"] .hide-on-expanded,#questionnaire-summary-details[aria-expanded="false"] .show-on-expanded{display:none}#questionnaire-summary>ul>li{font:400 1.1em Noto Sans,Open Sans,Lato}#questionnaire-submit{color:#000;border-radius:2px;margin-top:0.75em}#questionnaire-progress-bar{position:absolute;left:0;bottom:0;width:0;height:0.25em;background:#66FFCC;transition:all 0.2s ease-in;-o-transition:all 0.2s ease-in;-ms-transition:all 0.2s ease-in;-moz-transition:all 0.2s ease-in;-webkit-transition:all 0.2s ease-in}#questionnaire-rewind{margin-bottom:1em}#image-section{}#image-loading{font:900 3em Montserrat;text-transform:uppercase;cursor:wait}#image{cursor:crosshair;border-radius:0.2em;border:1px dashed rgba(0,0,0,0.15)}#image-source-container{margin:0.5em 0;font:400 1.1em Open Sans,Lato}#image-source>.fa-external-link{position:absolute;font-size:0.7em;margin:0.15em 0 0 0.05em}#image-zoomtip{font:900 1em Lato,Open Sans}
</style>
<script type="text/javascript">
window.wheelzoom=(function(){var defaults={zoom:0.10};var canvas=document.createElement('canvas');function setSrcToBackground(img){img.style.backgroundImage="url('"+img.src+"')";img.style.backgroundRepeat='no-repeat';canvas.width=img.naturalWidth;canvas.height=img.naturalHeight;img.src=canvas.toDataURL();}main=function(img,options){if(!img||!img.nodeName||img.nodeName!=='IMG')return;var settings={};var width;var height;var bgWidth;var bgHeight;var bgPosX;var bgPosY;var previousEvent;function updateBgStyle(){if(bgPosX>0)bgPosX=0;else if(bgPosX<width-bgWidth)bgPosX=width-bgWidth;if(bgPosY>0)bgPosY=0;else if(bgPosY<height-bgHeight)bgPosY=height-bgHeight;img.style.backgroundSize=bgWidth+'px '+bgHeight+'px';img.style.backgroundPosition=bgPosX+'px '+bgPosY+'px';}function reset(){bgWidth=width;bgHeight=height;bgPosX=bgPosY=0;updateBgStyle();}function onwheel(e){var deltaY=0;e.preventDefault();if(e.deltaY)deltaY=e.deltaY;else if(e.wheelDelta)deltaY=-e.wheelDelta;var rect=img.getBoundingClientRect();var offsetX=e.pageX-rect.left-document.body.scrollLeft;var offsetY=e.pageY-rect.top-document.body.scrollTop;var bgCursorX=offsetX-bgPosX;var bgCursorY=offsetY-bgPosY;var bgRatioX=bgCursorX/bgWidth;var bgRatioY=bgCursorY/bgHeight;if(deltaY<0){bgWidth+=bgWidth*settings.zoom;bgHeight+=bgHeight*settings.zoom;}else{bgWidth-=bgWidth*settings.zoom;bgHeight-=bgHeight*settings.zoom;}bgPosX=offsetX-(bgWidth*bgRatioX);bgPosY=offsetY-(bgHeight*bgRatioY);if(bgWidth<=width||bgHeight<=height)reset();else updateBgStyle();}function drag(e){e.preventDefault();bgPosX+=(e.pageX-previousEvent.pageX);bgPosY+=(e.pageY-previousEvent.pageY);previousEvent=e;updateBgStyle();}function removeDrag(){document.removeEventListener('mouseup',removeDrag);document.removeEventListener('mousemove',drag);}function draggable(e){e.preventDefault();previousEvent=e;document.addEventListener('mousemove',drag);document.addEventListener('mouseup',removeDrag);}function loaded(){var computedStyle=window.getComputedStyle(img,null);width=parseInt(computedStyle.width,10);height=parseInt(computedStyle.height,10);bgWidth=width;bgHeight=height;bgPosX=0;bgPosY=0;setSrcToBackground(img);img.style.backgroundSize=width+'px '+height+'px';img.style.backgroundPosition='0 0';img.addEventListener('wheelzoom.reset',reset);img.addEventListener('wheel',onwheel);img.addEventListener('mousedown',draggable);}img.addEventListener('wheelzoom.destroy',function(originalProperties){console.log(originalProperties);img.removeEventListener('wheelzoom.destroy');img.removeEventListener('wheelzoom.reset',reset);img.removeEventListener('load',onload);img.removeEventListener('mouseup',removeDrag);img.removeEventListener('mousemove',drag);img.removeEventListener('mousedown',draggable);img.removeEventListener('wheel',onwheel);img.style.backgroundImage=originalProperties.backgroundImage;img.style.backgroundRepeat=originalProperties.backgroundRepeat;img.src=originalProperties.src;}.bind(null,{backgroundImage:img.style.backgroundImage,backgroundRepeat:img.style.backgroundRepeat,src:img.src}));options=options||{};Object.keys(defaults).forEach(function(key){settings[key]=options[key]!==undefined?options[key]:defaults[key];});if(img.complete)loaded();else{function onload(){img.removeEventListener('load',onload);loaded();}img.addEventListener('load',onload);}};if(typeof window.getComputedStyle!=='function')return function(elements){return elements;};else return function(elements,options){if(elements&&elements.length)Array.prototype.forEach.call(elements,main,options);else if(elements&&elements.nodeName)main(elements,options);return elements;};}());(function(geotagx,$,undefined){"use strict";document.write('<script src="/static/js/pybossa/unosat.js">\x3C/script>');var task_={};var taskRun_={};var numberOfQuestions_=0;var percentageComplete_=0;var progress_=[];var onAnswerSubmitted_=function(){};$(document).ready(function(){numberOfQuestions_=$(".question").length;$("#questionnaire-rewind").click(task_.showPreviousQuestion);$("*[data-toggle=tooltip]").tooltip();$("#questionnaire-show-comments").on("click.loadDisqus",function(){var disqus_shortname='geotagx';(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();$(this).off("click.loadDisqus");}).click(function(){$(this).fadeOut(100,function(){$(this).addClass("hide");$("#questionnaire-hide-comments").removeClass("hide").hide().fadeIn();$("#disqus_thread").removeClass("hide").hide().fadeIn(100);});});$("#questionnaire-hide-comments").click(function(){$(this).fadeOut(100,function(){$(this).addClass("hide");$("#questionnaire-show-comments").removeClass("hide").hide().fadeIn();$("#disqus_thread").fadeOut(100,function(){$(this).addClass("hide");});});});$(".help-toggle").click(function(){var siblings=$(this).siblings("div.modal");if(siblings.length>0)$(siblings[0]).modal();});$("#questionnaire-summary-details").click(function(){$(this).attr("aria-expanded",$(this).attr("aria-expanded")==="true"?"false":"true");});$(".answer").each(function(){var property=$.trim($(this).data("saved-as"));if(property)taskRun_[property]=null;});});function getCurrentQuestion(){return progress_[progress_.length-1];}function getQuestionNodeId(question){return question>0&&question<numberOfQuestions_?"#questionnaire-question-"+question:question===0?"#questionnaire-filter":null;}function getCurrentQuestionNodeId(){return getQuestionNodeId(getCurrentQuestion());}function getQuestionHtml(question){return $(getQuestionNodeId(question));}function getCurrentQuestionHtml(){return getQuestionHtml(getCurrentQuestion());}function updateProgress(){percentageComplete_=progress_.length>0?((getCurrentQuestion()/numberOfQuestions_)*100).toFixed(0):0;$("#questionnaire-percentage-complete").html(percentageComplete_);$("#questionnaire-progress-bar").css("width",percentageComplete_+"%");};function isSpamFilter(question){return question===0;}function isSubmissionForm(question){return question===numberOfQuestions_;}function addAnswerCardEntry(questionId,answer){var $answerCard=$("#questionnaire-answer-card");if($answerCard.length>0){var nodeId=getQuestionNodeId(questionId);if(nodeId){var question=$(nodeId+" > header").html();if(question){var entry='<li id="questionnaire-answer-card-entry-'+questionId+'">'+question+' '+answer+'</li>';$(entry).hide().appendTo("#questionnaire-answer-card").fadeIn(200);}}var numberOfEntries=$("li",$answerCard).length;if($("#questionnaire-summary-details").hasClass("hide")&&numberOfEntries>0)$("#questionnaire-summary-details").removeClass("hide").hide().fadeIn();}}function removeAnswerCardEntry(question){setTimeout(function(){var $answerCard=$("#questionnaire-answer-card");$("#questionnaire-answer-card-entry-"+question).fadeOut(200,function(){$(this).remove();var numberOfEntries=$("li",$answerCard).length;if(!$("#questionnaire-summary-details").hasClass("hide")&&numberOfEntries==0)$("#questionnaire-summary-details").fadeOut(80,function(){$(this).addClass("hide");});});},150);}function beginTask(){$("input:checkbox").removeAttr("checked");$(".question").addClass("hide");progress_=[];for(var property in taskRun_)taskRun_[property]=null;task_.showQuestion(0);};function throttle(func,wait,options){var context,args,result,timeout=null,previous=0,_now=Date.now||function(){return new Date().getTime();};if(!options)options={};var later=function(){previous=options.leading===false?0:_now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null;};return function(){var now=_now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null;}previous=now;result=func.apply(context,args);if(!timeout)context=args=null;}else if(!timeout&&options.trailing!==false)timeout=setTimeout(later,remaining);return result;};};task_.saveAnswer=function(answer){var htmlNodeId=getCurrentQuestionNodeId();if(htmlNodeId){var property=$(htmlNodeId+" > div.answer").data("saved-as");if(property){var typeofAnswer=$.type(answer);if(typeofAnswer==="undefined")answer=null;else if(typeofAnswer==="object")if(answer.length>0){var tmp="";answer.each(function(){tmp+=","+$(this).val();});answer=tmp.substring(1);}else answer="None";taskRun_[property]=answer;}else console.log("[geotagx::task::saveAnswer] Could not find a 'saved-as' data attribute. Discarding answer...");}};task_.showQuestion=function(question){var hasAnsweredQuestion=progress_.length>0;$("#questionnaire-rewind").prop("disabled",!hasAnsweredQuestion);if(hasAnsweredQuestion)getCurrentQuestionHtml().addClass("hide");if(question>=0&&question<=numberOfQuestions_){progress_.push(question);updateProgress();if(isSubmissionForm(question)){console.log("Showing answer card...");console.log(taskRun_);}else getCurrentQuestionHtml().removeClass("hide").hide().fadeIn(300);}else console.log("[geotagx::task::showQuestion] Error! Invalid question identifier '"+question+"'.");};task_.showNextQuestion=function(){task_.showQuestion(getCurrentQuestion()+1);};task_.showPreviousQuestion=function(){if(progress_.length>=2){var current=progress_[progress_.length-1];var previous=progress_[progress_.length-2];task_.saveAnswer(null);removeAnswerCardEntry(previous);progress_.pop();updateProgress();if(progress_.length===1)$("#questionnaire-rewind").prop("disabled",true);getQuestionHtml(previous).removeClass("hide");getQuestionHtml(current).addClass("hide");}else console.log("[geotagx::task::showPrevQuestion] Error! Could not load the previous question!");};task_.finish=function(){task_.showQuestion(numberOfQuestions_);};task_.run=function(project,onAnswerSubmitted){if($.type(project)!=="string"||$.type(onAnswerSubmitted)!=="function"){console.log("[geotagx::task::run] Error! Invalid function parameter.");return;}onAnswerSubmitted_=onAnswerSubmitted;pybossa.taskLoaded(function(task,deferred){if(!$.isEmptyObject(task)){var $image=$("<img/>");$image.load(function(){deferred.resolve(task);});$image.attr('src',task.info.url);$image.attr('id','anno_'+task.id);$image.addClass('img-polaroid');$image.addClass('annotable');task.info.image=$image;taskRun_.task_id=task.id;taskRun_.img=task.info.url;}else deferred.resolve(task);});pybossa.presentTask(function(task,deferred){if(!$.isEmptyObject(task)){$(".show-on-task-loaded").removeClass("show-on-task-loaded").hide().fadeIn(200);$(".hide-on-task-loaded").hide();var $image=$("#image");if($image.length>0){$image.attr("src",task.info.url);$image.addClass("highlight");$image.addClass("wheelzoom");$("#image-source").attr("href",task.info.uri);$("#image-loading").addClass("hide");wheelzoom($image);}else console.log("[pybossa::presentTask] Error! Could not find image to analyze.");$("#questionnaire-show-comments").prop("disabled",false);beginTask();$(".btn-answer").click(throttle(function(){var $submitter=$(this);var answer=$submitter.attr("value");var question=getCurrentQuestion();var questionHtml=getQuestionHtml(question);if(isSpamFilter(question))if(answer==="No")geotagx.task.showNextQuestion();else geotagx.task.finish();else if($submitter.attr("id")==="questionnaire-submit"){var $button=$(this);$button.prop("disabled",true);console.log("Saving result...");console.log(taskRun_);}else onAnswerSubmitted_(question,answer,$submitter);addAnswerCardEntry(question,answer);},800));}else{}});pybossa.run("yamuna_waters");};geotagx.task=task_;})(window.geotagx=window.geotagx||{},jQuery);
</script>
<script type="text/javascript">
// Run the application.
geotagx.task.run("yamuna_waters", function(question, answer, $submitter){
    switch (question){
        case 1: // Can you see any water in the photo?
        case 7: // Can you see any sources of drinking water?
            geotagx.task.saveAnswer(answer);
            if (answer === "Yes")
                geotagx.task.showNextQuestion();
            else
                geotagx.task.finish();
            break;
        case 2: // Can you see small pools of water?
            geotagx.task.saveAnswer(answer);
            geotagx.task.showQuestion(answer === "Yes" ? 3 : 4);
            break;
        case 3: // Are these small pools of water near human shelters or a settlement?
            geotagx.task.saveAnswer(answer);
            geotagx.task.showQuestion(7);
            break;
        case 4: // Can you see a large body of water?
            geotagx.task.saveAnswer(answer);
            geotagx.task.showQuestion(answer === "Yes" ? 5 : 6);
            break;
        case 5: // Can you see any signs of fast moving water?
        case 6: // Can you see any of the following flood protection measures?
        case 8: // Which sources of drinking water can you see?
            geotagx.task.saveAnswer(answer === "Done" ? $submitter.siblings("input:checked") : answer);
            geotagx.task.showNextQuestion();
            break;
        case 9: // Have they been affected by the flood waters?
        default:
            geotagx.task.saveAnswer(answer);
            geotagx.task.showNextQuestion();
            break;
    }
});
</script>

